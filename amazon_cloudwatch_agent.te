policy_module(amazon_cloudwatch_agent, 1.0.2)

require {
    type init_t;
    type amazon_cloudwatch_agent_exec_t;
    attribute domain;
    attribute daemon;
    class process { transition };
    class file { read getattr open execute execute_no_trans entrypoint };
}

type amazon_cloudwatch_agent_t, domain, daemon;
domain_entry_file(amazon_cloudwatch_agent_t, amazon_cloudwatch_agent_exec_t)

# Allow init to execute and transition to the agent
allow init_t amazon_cloudwatch_agent_exec_t:file { getattr open read execute execute_no_trans };
allow init_t amazon_cloudwatch_agent_t:process transition;
allow amazon_cloudwatch_agent_t amazon_cloudwatch_agent_exec_t:file entrypoint;

# Basic permissions for the agent to function
allow amazon_cloudwatch_agent_t self:process { fork sigchld };
allow amazon_cloudwatch_agent_t self:fifo_file rw_fifo_file_perms;
allow amazon_cloudwatch_agent_t self:unix_stream_socket create_stream_socket_perms;
